name: "CI Check"

on:
  pull_request:
    branches: 
      - '**'

# Cancel prev CI if new commit come
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  test:
    runs-on: ubuntu-latest
    name: Run Test on Node ${{ matrix.node }}
    steps:
      - name: checkout
        uses: actions/checkout@v4
      - name: Setup node
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node }}
      - name: Setup yarn
        run: npm install -g yarn
      - name: Install deps
        run: yarn install --frozen-lockfile
        timeout-minutes: 15
      # - name: Test
      #   run: yarn test
      - name: Build
        run: yarn build
      - name: Check Locales
        id: scan
        run: yarn api:scan
        continue-on-error: true
      - name: Read scan result
        id: read-result
        if: always()
        run: |
          if [ -f "./cloudtower-api-doc/scripts/check-missing.log" ]; then
            echo "result<<EOF" >> $GITHUB_OUTPUT
            cat "./cloudtower-api-doc/scripts/check-missing.log" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          else
            echo "result=No scan result file found." >> $GITHUB_OUTPUT
          fi
      - name: Comment PR
        if: always()
        uses: mshick/add-pr-comment@v2
        with:
          message-id: check-locales
          message: |
            ## ðŸ“‹ Check Locales Result
            
            ${{ steps.read-result.outputs.result }}
            
            ---
            
            <sub>ðŸ¤– This comment is automatically updated on each run.</sub>